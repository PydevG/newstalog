{% extends 'blogs/base.html' %}
{% load static %}

{% block title %}Create New Post{% endblock %}

{% block cssimports %}
<link rel="stylesheet" href="{% static 'css/create_post.css' %}">

<style>
    /* Fix for navbar overlapping title */
    .container {
        margin-top: 100px;
    }
    /* Image preview styling */
    #previewImage {
        display: none;
        max-height: 150px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
</style>
{% endblock %}

{% block main %}
<div class="container">
    <h2 class="text-center mb-4">Create a New Blog Post</h2>

    <form method="POST" enctype="multipart/form-data" id="postForm">
        {% csrf_token %}

        <div class="row">
            <!-- Left Column -->
            <div class="col-md-8">
                <div class="mb-3">
                    <label for="title" class="form-label">Title</label>
                    <input type="text" class="form-control" id="title" name="title" required>
                </div>

                <div class="mb-3">
                    <label for="content" class="form-label">Content</label>
                    <textarea class="form-control" id="content" name="content" rows="6" required></textarea>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="category" class="form-label">Category</label>
                    <select class="form-select" id="category" name="category" required>
                        <option value="">-- Select Category --</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="tags" class="form-label">Tags</label>
                    <select class="form-select" id="tags" name="tags" multiple>
                        {% for tag in tags %}
                        <option value="{{ tag.id }}">{{ tag.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="image" class="form-label">Upload Image</label>
                    <input type="file" class="form-control" id="image" name="image" accept="image/*">
                    <img id="previewImage" class="img-thumbnail mt-2">
                </div>

                <button type="submit" class="btn btn-primary w-100 mb-3" id="submitButton">Create Post</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block jsimports %}
<!-- Updated CKEditor -->
<script src="https://cdn.ckeditor.com/4.25.1-lts/standard/ckeditor.js"></script>
<script>
    // Initialize CKEditor with custom toolbar
    CKEDITOR.replace('content', {
        height: 300,
        toolbar: [
            { name: 'basicstyles', items: ['Bold', 'Italic', 'Underline', 'Strike'] },
            { name: 'paragraph', items: ['NumberedList', 'BulletedList', 'Blockquote'] },
            { name: 'insert', items: ['Image', 'Table', 'Link', 'Unlink'] },
            { name: 'tools', items: ['Maximize'] },
            { name: 'document', items: ['Source'] }
        ]
    });

    document.addEventListener('DOMContentLoaded', function () {
    let form = document.getElementById('postForm');
    let submitButton = document.getElementById('submitButton');

    form.addEventListener('submit', function () {
        // Disable the button to prevent multiple clicks
        submitButton.disabled = true;
        submitButton.innerHTML = 'Submitting...'; // Optional: Change button text
    });
});

    // Image preview
    document.getElementById('image').addEventListener('change', function (event) {
        let file = event.target.files[0];
        if (file) {
            let reader = new FileReader();
            reader.onload = function () {
                let img = document.getElementById('previewImage');
                img.src = reader.result;
                img.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });
</script>
{% endblock %}
